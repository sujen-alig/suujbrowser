<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suuj Browser</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }
        body.dark-mode {
            background: linear-gradient(135deg, #1f2937, #374151);
            color: #f3f4f6;
        }
        #toolbar {
            background: #111827;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        body.dark-mode #toolbar {
            background: #0f172a;
        }
        #urlInput {
            flex: 1;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border: none;
            border-radius: 9999px;
            background: #e5e7eb;
            min-width: 200px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: background 0.3s, color 0.3s;
        }
        body.dark-mode #urlInput {
            background: #374151;
            color: #f3f4f6;
        }
        #urlInput:focus {
            outline: none;
            background: #ffffff;
        }
        body.dark-mode #urlInput:focus {
            background: #4b5563;
        }
        #tabsContainer {
            background: #1f2937;
            padding: 0.25rem;
            display: flex;
            gap: 0.25rem;
            overflow-x: auto;
        }
        body.dark-mode #tabsContainer {
            background: #111827;
        }
        .tab {
            background: #4b5563;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem 0.5rem 0 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #d1d5db;
            transition: background 0.3s;
            user-select: none;
        }
        body.dark-mode .tab {
            background: #6b7280;
        }
        .tab.active {
            background: #ffffff;
            color: #111827;
            font-weight: 600;
        }
        body.dark-mode .tab.active {
            background: #1f2937;
            color: #f3f4f6;
        }
        .tab:hover {
            background: #6b7280;
        }
        body.dark-mode .tab:hover {
            background: #9ca3af;
        }
        .tab .closeTab {
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 1.125rem;
            height: 1.125rem;
            line-height: 1.125rem;
            text-align: center;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        .tab .closeTab:hover {
            background: #dc2626;
        }
        #browserWindow {
            flex: 1;
            position: relative;
            background: #ffffff;
            border-radius: 0.5rem;
            margin: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        body.dark-mode #browserWindow {
            background: #1f2937;
        }
        .siteContentContainer {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            overflow-y: auto;
            padding: 1.5rem;
            box-sizing: border-box;
        }
        .siteContentContainer.active {
            display: block;
        }
        .siteContent {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            background: #f9fafb;
            animation: fadeIn 0.3s ease-in-out;
        }
        body.dark-mode .siteContent {
            border-color: #4b5563;
            background: #374151;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .siteContent img.favicon {
            width: 1rem;
            height: 1rem;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        .siteContent h3 {
            margin: 0;
            font-size: 1.25rem;
            color: #1d4ed8;
            display: inline;
        }
        body.dark-mode .siteContent h3 {
            color: #60a5fa;
        }
        .siteContent p {
            margin: 0.5rem 0;
            color: #4b5563;
        }
        body.dark-mode .siteContent p {
            color: #d1d5db;
        }
        .siteContent a {
            color: #15803d;
            font-size: 0.875rem;
            text-decoration: none;
        }
        body.dark-mode .siteContent a {
            color: #34d399;
        }
        .siteContent a:hover {
            text-decoration: underline;
        }
        #error {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fee2e2;
            padding: 1.5rem;
            border-radius: 0.5rem;
            color: #b91c1c;
            font-size: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        body.dark-mode #error {
            background: #b91c1c;
            color: #f3f4f6;
        }
        #searchResults, #newTabPage, #historyPanel, #bookmarksPanel {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            overflow-y: auto;
            padding: 1.5rem;
            box-sizing: border-box;
            border-radius: 0.5rem;
        }
        body.dark-mode #searchResults,
        body.dark-mode #newTabPage,
        body.dark-mode #historyPanel,
        body.dark-mode #bookmarksPanel {
            background: #1f2937;
        }
        #newTabPage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        #newTabPage h2 {
            color: #111827;
            margin-bottom: 1rem;
        }
        body.dark-mode #newTabPage h2 {
            color: #f3f4f6;
        }
        .searchResult, .historyItem, .bookmarkItem {
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            border-left: 3px solid #3b82f6;
            animation: fadeIn 0.3s ease-in-out;
        }
        body.dark-mode .searchResult,
        body.dark-mode .historyItem,
        body.dark-mode .bookmarkItem {
            border-left-color: #60a5fa;
        }
        .searchResult h3, .historyItem h3, .bookmarkItem h3 {
            margin: 0;
            font-size: 1.125rem;
            color: #1d4ed8;
            cursor: pointer;
        }
        body.dark-mode .searchResult h3,
        body.dark-mode .historyItem h3,
        body.dark-mode .bookmarkItem h3 {
            color: #60a5fa;
        }
        .searchResult h3:hover, .historyItem h3:hover, .bookmarkItem h3:hover {
            text-decoration: underline;
        }
        .searchResult p, .historyItem p, .bookmarkItem p {
            margin: 0.25rem 0;
            color: #4b5563;
        }
        body.dark-mode .searchResult p,
        body.dark-mode .historyItem p,
        body.dark-mode .bookmarkItem p {
            color: #d1d5db;
        }
        .searchResult a, .historyItem a, .bookmarkItem a {
            color: #15803d;
            font-size: 0.875rem;
        }
        body.dark-mode .searchResult a,
        body.dark-mode .historyItem a,
        body.dark-mode .bookmarkItem a {
            color: #34d399;
        }
        .bookmarkItem button {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background 0.3s;
        }
        .bookmarkItem button:hover {
            background: #dc2626;
        }
        .downloadAppBtn {
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background 0.3s;
        }
        .downloadAppBtn:hover {
            background: #16a34a;
        }
        #userInfo {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        body.dark-mode #userInfo {
            background: rgba(0, 0, 0, 0.9);
            color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100">
    <div id="toolbar" class="sticky top-0 z-10">
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="goBack()">Back</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="goForward()">Forward</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="refresh()">Refresh</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="newTab()">New Tab</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="showHistory()">History</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="showBookmarks()">Bookmarks</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="bookmarkCurrentPage()">Bookmark</button>
        <button id="themeToggle" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-full transition transform hover:scale-105" onclick="toggleTheme()">Dark Mode</button>
        <input type="text" id="urlInput" class="focus:ring-2 focus:ring-blue-500" placeholder="Enter URL or search query..." onkeydown="if(event.key === 'Enter') searchOrNavigate()">
    </div>
    <div id="tabsContainer"></div>
    <div id="browserWindow">
        <div id="error"></div>
        <div id="userInfo"></div>
        <div id="searchResults"></div>
        <div id="newTabPage" class="flex flex-col items-center justify-center text-center">
            <h2 class="text-2xl font-bold">Welcome to Suuj Browser</h2>
            <p class="mt-2">Search for any website or enter a URL to get started.</p>
            <div class="mt-4">
                <a href="#" class="quickLink bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105 mx-1" onclick="navigate('https://www.example.com'); return false;">Example</a>
                <a href="#" class="quickLink bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105 mx-1" onclick="navigate('https://www.wikipedia.org'); return false;">Wikipedia</a>
                <a href="#" class="quickLink bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105 mx-1" onclick="navigate('https://www.github.com'); return false;">GitHub</a>
            </div>
        </div>
        <div id="historyPanel"></div>
        <div id="bookmarksPanel"></div>
    </div>

    <script>
        let tabs = [];
        let currentTabIndex = -1;
        let historyList = JSON.parse(localStorage.getItem('browserHistory')) || [];
        let bookmarks = JSON.parse(localStorage.getItem('browserBookmarks')) || [];
        let searchCache = JSON.parse(localStorage.getItem('searchCache')) || {};

        // Load saved tabs, theme, and user info on page load
        window.onload = function() {
            const savedTabs = localStorage.getItem('browserTabs');
            const savedTheme = localStorage.getItem('browserTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').textContent = 'Light Mode';
            }
            if (savedTabs) {
                tabs = JSON.parse(savedTabs);
                if (tabs.length > 0) {
                    currentTabIndex = 0;
                    renderTabs();
                    switchTab(0);
                } else {
                    showNewTabPage();
                }
            } else {
                showNewTabPage();
            }
            makeTabsDraggable();
            fetchUserInfo();
        };

        // Fetch user location and display info
        function fetchUserInfo() {
            fetch('http://ip-api.com/json/')
                .then(response => response.json())
                .then(data => {
                    const userInfoDiv = document.getElementById('userInfo');
                    userInfoDiv.innerHTML = `Location: ${data.city}, ${data.country} | Time: ${new Date().toLocaleTimeString()}`;
                })
                .catch(error => {
                    console.error('Error fetching user info:', error);
                    document.getElementById('userInfo').innerHTML = 'Location: Unknown | Time: ' + new Date().toLocaleTimeString();
                });
        }

        function showNewTabPage() {
            document.getElementById('newTabPage').style.display = 'flex';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });
        }

        function newTab(url = null) {
            const tabId = Date.now();
            const tab = { id: tabId, url: url || 'about:newtab', history: [url || 'about:newtab'], historyIndex: 0 };
            tabs.push(tab);
            currentTabIndex = tabs.length - 1;

            if (url) {
                const contentContainer = document.createElement('div');
                contentContainer.className = 'siteContentContainer';
                contentContainer.id = `content-${tabId}`;
                document.getElementById('browserWindow').appendChild(contentContainer);
            }

            renderTabs();
            switchTab(currentTabIndex);
            backupTabs();
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('tabsContainer');
            tabsContainer.innerHTML = '';
            tabs.forEach((tab, index) => {
                const tabElement = document.createElement('div');
                tabElement.className = `tab ${index === currentTabIndex ? 'active' : ''}`;
                tabElement.draggable = true;
                tabElement.dataset.index = index;
                tabElement.innerHTML = `
                    <span onclick="switchTab(${index})">${tab.url === 'about:newtab' ? 'New Tab' : new URL(tab.url).hostname}</span>
                    <span class="closeTab" onclick="closeTab(${index})">x</span>
                `;
                tabsContainer.appendChild(tabElement);
            });
        }

        function makeTabsDraggable() {
            const tabsContainer = document.getElementById('tabsContainer');
            let draggedTab = null;

            tabsContainer.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('tab')) {
                    draggedTab = e.target;
                    e.target.style.opacity = '0.5';
                }
            });

            tabsContainer.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('tab')) {
                    e.target.style.opacity = '1';
                    draggedTab = null;
                }
            });

            tabsContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            tabsContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                const targetTab = e.target.closest('.tab');
                if (targetTab && draggedTab && targetTab !== draggedTab) {
                    const draggedIndex = parseInt(draggedTab.dataset.index);
                    const targetIndex = parseInt(targetTab.dataset.index);
                    const [movedTab] = tabs.splice(draggedIndex, 1);
                    tabs.splice(targetIndex, 0, movedTab);
                    currentTabIndex = tabs.findIndex(tab => tab.id === movedTab.id);
                    renderTabs();
                    switchTab(currentTabIndex);
                }
            });
        }

        function switchTab(index) {
            if (index < 0 || index >= tabs.length) return;
            currentTabIndex = index;
            const tab = tabs[index];

            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab) tab.classList.remove('active');
            });

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';

            if (tab.url === 'about:newtab') {
                showNewTabPage();
            } else {
                let contentContainer = document.getElementById(`content-${tab.id}`);
                if (!contentContainer) {
                    contentContainer = document.createElement('div');
                    contentContainer.className = 'siteContentContainer';
                    contentContainer.id = `content-${tab.id}`;
                    document.getElementById('browserWindow').appendChild(contentContainer);
                }
                contentContainer.classList.add('active');
                renderSiteContent(tab.url, contentContainer);
            }

            const tabElement = document.getElementsByClassName('tab')[index];
            if (tabElement) tabElement.classList.add('active');
            document.getElementById('urlInput').value = tab.url === 'about:newtab' ? '' : tab.url;
        }

        function closeTab(index) {
            const tabId = tabs[index].id;
            const contentContainer = document.getElementById(`content-${tabId}`);
            if (contentContainer) contentContainer.remove();
            tabs.splice(index, 1);
            if (tabs.length === 0) {
                currentTabIndex = -1;
                showNewTabPage();
            } else {
                if (currentTabIndex >= tabs.length) {
                    currentTabIndex = tabs.length - 1;
                }
                switchTab(currentTabIndex);
            }
            renderTabs();
            backupTabs();
        }

        function searchOrNavigate() {
            const urlInput = document.getElementById('urlInput').value.trim();
            if (!urlInput) return;

            let url = urlInput;
            if (!url.includes('.')) {
                performSearch(url);
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = `https://${url}`;
            }

            navigate(url);
        }

        function performSearch(query) {
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '<p>Searching...</p>';
            searchResultsDiv.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            // Check cache first
            if (searchCache[query]) {
                renderSearchResults(searchCache[query], query);
                return;
            }

            // Use DuckDuckGo API for real-time search
            fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1`)
                .then(response => response.json())
                .then(data => {
                    const results = data.RelatedTopics.filter(topic => topic.FirstURL);
                    if (results.length === 0) {
                        // Fallback: Try assuming a URL with different TLDs
                        const tlds = ['.com', '.org', '.net', '.edu', '.gov'];
                        const assumedUrls = tlds.map(tld => `https://${query.replace(/\s+/g, '')}${tld}`);
                        const assumedResults = assumedUrls.map(url => ({
                            FirstURL: url,
                            Text: `${query} (Assumed Site) - This site may not be in our database. Navigate to explore it.`
                        }));
                        searchCache[query] = assumedResults;
                        localStorage.setItem('searchCache', JSON.stringify(searchCache));
                        renderSearchResults(assumedResults, query);
                        return;
                    }

                    searchCache[query] = results;
                    localStorage.setItem('searchCache', JSON.stringify(searchCache));
                    renderSearchResults(results, query);
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                    // Fallback: Assume a URL if search fails
                    const assumedUrl = `https://${query.replace(/\s+/g, '')}.com`;
                    const assumedResults = [{
                        FirstURL: assumedUrl,
                        Text: `${query} (Assumed Site) - This site may not be in our database. Navigate to explore it.`
                    }];
                    searchCache[query] = assumedResults;
                    localStorage.setItem('searchCache', JSON.stringify(searchCache));
                    renderSearchResults(assumedResults, query);
                });
        }

        function renderSearchResults(results, query) {
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '';

            results.forEach(result => {
                const url = result.FirstURL;
                const title = result.Text.split(' - ')[0];
                const description = result.Text;
                const favicon = `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}`;

                const resultDiv = document.createElement('div');
                resultDiv.className = 'searchResult';
                resultDiv.innerHTML = `
                    <a href="${url}" onclick="navigate('${url}'); return false;">${url}</a>
                    <h3 onclick="navigate('${url}')"><img src="${favicon}" alt="Favicon" class="favicon">${title}</h3>
                    <p>Browser: Suuj Browser</p>
                    <p>${description}</p>
                    <button class="downloadAppBtn" onclick="downloadApp('${title}', '${url}')">Download as App</button>
                `;
                searchResultsDiv.appendChild(resultDiv);
            });
        }

        function renderSiteContent(url, container) {
            container.innerHTML = '<p>Loading content...</p>';

            // Fetch site content using a CORS proxy
            fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`)
                .then(response => response.json())
                .then(data => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data.contents, 'text/html');
                    const title = doc.querySelector('title')?.textContent || new URL(url).hostname;
                    const description = doc.querySelector('meta[name="description"]')?.content || 'No description available.';
                    const favicon = `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}`;

                    // Extract some basic content (e.g., text from paragraphs)
                    const paragraphs = Array.from(doc.querySelectorAll('p')).map(p => p.textContent).join('<br>');
                    const content = paragraphs || 'No additional content available.';

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'siteContent';
                    contentDiv.innerHTML = `
                        <a href="${url}" onclick="navigate('${url}'); return false;">${url}</a>
                        <h3><img src="${favicon}" alt="Favicon" class="favicon">${title}</h3>
                        <p>${description}</p>
                        <p>Browser: Suuj Browser</p>
                        <div class="extracted-content">${content}</div>
                        <button class="downloadAppBtn" onclick="downloadApp('${title}', '${url}')">Download as App</button>
                    `;

                    // Intercept all link clicks within the content
                    contentDiv.querySelectorAll('a').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const href = link.getAttribute('href');
                            if (href && !href.startsWith('#')) {
                                navigate(href.startsWith('http') ? href : new URL(href, url).href);
                            }
                        });
                    });

                    container.innerHTML = '';
                    container.appendChild(contentDiv);
                })
                .catch(error => {
                    console.error('Error fetching site content:', error);
                    container.innerHTML = `
                        <div class="siteContent">
                            <a href="${url}" onclick="navigate('${url}'); return false;">${url}</a>
                            <h3>${new URL(url).hostname}</h3>
                            <p>Unable to load content for this site.</p>
                            <p>Browser: Suuj Browser</p>
                            <button class="downloadAppBtn" onclick="downloadApp('${new URL(url).hostname}', '${url}')">Download as App</button>
                        </div>
                    `;
                });
        }

        function downloadApp(siteName, siteUrl, appLink) {
            const content = appLink ? 
                `App Download for ${siteName}\n\nVisit the following link to download the app on your phone:\n${appLink}\n\nAlternatively, search for "${siteName}" in your phone's app store.` :
                `App Download for ${siteName}\n\nNo app link available for this site.\nVisit ${siteUrl} on your phone and look for a mobile app option, or search for "${siteName}" in your phone's app store.`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${siteName.replace(/\s+/g, '_')}_app_info.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function navigate(url) {
            let tab = tabs[currentTabIndex];
            let contentContainer = document.getElementById(`content-${tab.id}`);

            if (tab.url === 'about:newtab' || !contentContainer) {
                const tabId = tab.id;
                contentContainer = document.createElement('div');
                contentContainer.className = 'siteContentContainer';
                contentContainer.id = `content-${tabId}`;
                document.getElementById('browserWindow').appendChild(contentContainer);
            }

            tab.url = url;
            contentContainer.classList.add('active');

            tab.history = tab.history.slice(0, tab.historyIndex + 1);
            tab.history.push(url);
            tab.historyIndex = tab.history.length - 1;

            historyList.push({
                url: url,
                title: new URL(url).hostname,
                timestamp: new Date().toLocaleString()
            });
            localStorage.setItem('browserHistory', JSON.stringify(historyList));

            document.getElementById('urlInput').value = url;
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            renderTabs();
            backupTabs();

            renderSiteContent(url, contentContainer);
        }

        function goBack() {
            const tab = tabs[currentTabIndex];
            if (tab.historyIndex > 0) {
                tab.historyIndex--;
                tab.url = tab.history[tab.historyIndex];
                const contentContainer = document.getElementById(`content-${tab.id}`);
                if (contentContainer) {
                    renderSiteContent(tab.url, contentContainer);
                    document.getElementById('urlInput').value = tab.url;
                    renderTabs();
                }
            }
        }

        function goForward() {
            const tab = tabs[currentTabIndex];
            if (tab.historyIndex < tab.history.length - 1) {
                tab.historyIndex++;
                tab.url = tab.history[tab.historyIndex];
                const contentContainer = document.getElementById(`content-${tab.id}`);
                if (contentContainer) {
                    renderSiteContent(tab.url, contentContainer);
                    document.getElementById('urlInput').value = tab.url;
                    renderTabs();
                }
            }
        }

        function refresh() {
            const tab = tabs[currentTabIndex];
            if (tab.url === 'about:newtab') return;
            const contentContainer = document.getElementById(`content-${tab.id}`);
            if (contentContainer) {
                renderSiteContent(tab.url, contentContainer);
            }
        }

        function backupTabs() {
            localStorage.setItem('browserTabs', JSON.stringify(tabs));
        }

        function showHistory() {
            const historyPanel = document.getElementById('historyPanel');
            historyPanel.innerHTML = '<h2 class="text-xl font-bold mb-4">Browsing History</h2>';
            historyPanel.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            if (historyList.length === 0) {
                historyPanel.innerHTML += '<p>No history available.</p>';
                return;
            }

            historyList.forEach(item => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'historyItem';
                historyDiv.innerHTML = `
                    <a href="${item.url}" onclick="navigate('${item.url}'); return false;">${item.url}</a>
                    <h3 onclick="navigate('${item.url}')">${item.title}</h3>
                    <p>Visited: ${item.timestamp}</p>
                `;
                historyPanel.appendChild(historyDiv);
            });
        }

        function showBookmarks() {
            const bookmarksPanel = document.getElementById('bookmarksPanel');
            bookmarksPanel.innerHTML = '<h2 class="text-xl font-bold mb-4">Bookmarks</h2>';
            bookmarksPanel.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            if (bookmarks.length === 0) {
                bookmarksPanel.innerHTML += '<p>No bookmarks available.</p>';
                return;
            }

            bookmarks.forEach((bookmark, index) => {
                const bookmarkDiv = document.createElement('div');
                bookmarkDiv.className = 'bookmarkItem';
                bookmarkDiv.innerHTML = `
                    <a href="${bookmark.url}" onclick="navigate('${bookmark.url}'); return false;">${bookmark.url}</a>
                    <h3 onclick="navigate('${bookmark.url}')">${bookmark.title}</h3>
                    <button onclick="removeBookmark(${index})">Remove</button>
                `;
                bookmarksPanel.appendChild(bookmarkDiv);
            });
        }

        function bookmarkCurrentPage() {
            const tab = tabs[currentTabIndex];
            if (tab.url === 'about:newtab') {
                showError('No page to bookmark. Navigate to a website first.');
                return;
            }

            bookmarks.push({
                url: tab.url,
                title: new URL(tab.url).hostname
            });
            localStorage.setItem('browserBookmarks', JSON.stringify(bookmarks));
            showBookmarks();
        }

        function removeBookmark(index) {
            bookmarks.splice(index, 1);
            localStorage.setItem('browserBookmarks', JSON.stringify(bookmarks));
            showBookmarks();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            localStorage.setItem('browserTheme', theme);
            document.getElementById('themeToggle').textContent = theme === 'dark' ? 'Light Mode' : 'Dark Mode';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function hideError() {
            const errorDiv = document.getElementById('error');
            errorDiv.style.display = 'none';
        }
    </script>
</body>
</html>
