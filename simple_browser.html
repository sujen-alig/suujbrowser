<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#111827">
    <title>Suuj Browser</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="https://www.google.com/s2/favicons?domain=suujbrowser.com" type="image/png">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }
        body.dark-mode {
            background: linear-gradient(135deg, #1f2937, #374151);
            color: #f3f4f6;
        }
        #toolbar {
            background: #111827;
            padding: 0.25rem 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            flex-wrap: wrap;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        body.dark-mode #toolbar {
            background: #0f172a;
        }
        #urlInput {
            flex: 1;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            border: none;
            border-radius: 9999px;
            background: #e5e7eb;
            min-width: 150px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            transition: background 0.3s, color 0.3s;
        }
        body.dark-mode #urlInput {
            background: #374151;
            color: #f3f4f6;
        }
        #urlInput:focus {
            outline: none;
            background: #ffffff;
        }
        body.dark-mode #urlInput:focus {
            background: #4b5563;
        }
        #tabsContainer {
            background: #1f2937;
            padding: 0.125rem;
            display: flex;
            gap: 0.125rem;
            overflow-x: auto;
        }
        body.dark-mode #tabsContainer {
            background: #111827;
        }
        .tab {
            background: #4b5563;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem 0.25rem 0 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #d1d5db;
            transition: background 0.3s;
            user-select: none;
            font-size: 0.875rem;
        }
        body.dark-mode .tab {
            background: #6b7280;
        }
        .tab.active {
            background: #ffffff;
            color: #111827;
            font-weight: 600;
        }
        body.dark-mode .tab.active {
            background: #1f2937;
            color: #f3f4f6;
        }
        .tab:hover {
            background: #6b7280;
        }
        body.dark-mode .tab:hover {
            background: #9ca3af;
        }
        .tab .closeTab {
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            line-height: 1rem;
            text-align: center;
            font-size: 0.625rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        .tab .closeTab:hover {
            background: #dc2626;
        }
        #browserWindow {
            position: absolute;
            top: 60px;
            bottom: 0;
            left: 0.5rem;
            right: 0.5rem;
            background: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        body.dark-mode #browserWindow {
            background: #1f2937;
        }
        .siteContentContainer {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            overflow-y: auto;
            padding: 1rem;
            box-sizing: border-box;
        }
        .siteContentContainer.active {
            display: block;
        }
        .siteContent {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            background: #f9fafb;
            animation: fadeIn 0.3s ease-in-out;
            transition: transform 0.3s;
        }
        body.dark-mode .siteContent {
            border-color: #4b5563;
            background: #374151;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .siteContent img.favicon {
            width: 1rem;
            height: 1rem;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        .siteContent img.extracted-image {
            max-width: 100%;
            height: auto;
            margin: 0.5rem 0;
            border-radius: 0.25rem;
        }
        .siteContent h3 {
            margin: 0;
            font-size: 1.25rem;
            color: #1d4ed8;
            display: inline;
        }
        body.dark-mode .siteContent h3 {
            color: #60a5fa;
        }
        .siteContent p {
            margin: 0.5rem 0;
            color: #4b5563;
        }
        body.dark-mode .siteContent p {
            color: #d1d5db;
        }
        .siteContent a {
            color: #15803d;
            font-size: 0.875rem;
            text-decoration: none;
        }
        body.dark-mode .siteContent a {
            color: #34d399;
        }
        .siteContent a:hover {
            text-decoration: underline;
        }
        #error {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fee2e2;
            padding: 1.5rem;
            border-radius: 0.5rem;
            color: #b91c1c;
            font-size: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        body.dark-mode #error {
            background: #b91c1c;
            color: #f3f4f6;
        }
        #searchResults, #newTabPage, #historyPanel, #bookmarksPanel, #downloadsPanel, #tabOverview {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            overflow-y: auto;
            padding: 1rem;
            box-sizing: border-box;
            border-radius: 0.5rem;
        }
        body.dark-mode #searchResults,
        body.dark-mode #newTabPage,
        body.dark-mode #historyPanel,
        body.dark-mode #bookmarksPanel,
        body.dark-mode #downloadsPanel,
        body.dark-mode #tabOverview {
            background: #1f2937;
        }
        #newTabPage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        #newTabPage h2 {
            color: #111827;
            margin-bottom: 1rem;
        }
        body.dark-mode #newTabPage h2 {
            color: #f3f4f6;
        }
        .searchResult, .historyItem, .bookmarkItem, .downloadItem, .tabItem {
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-left: 3px solid #3b82f6;
            animation: fadeIn 0.3s ease-in-out;
        }
        body.dark-mode .searchResult,
        body.dark-mode .historyItem,
        body.dark-mode .bookmarkItem,
        body.dark-mode .downloadItem,
        body.dark-mode .tabItem {
            border-left-color: #60a5fa;
        }
        .searchResult h3, .historyItem h3, .bookmarkItem h3, .downloadItem h3, .tabItem h3 {
            margin: 0;
            font-size: 1.125rem;
            color: #1d4ed8;
            cursor: pointer;
        }
        body.dark-mode .searchResult h3,
        body.dark-mode .historyItem h3,
        body.dark-mode .bookmarkItem h3,
        body.dark-mode .downloadItem h3,
        body.dark-mode .tabItem h3 {
            color: #60a5fa;
        }
        .searchResult h3:hover, .historyItem h3:hover, .bookmarkItem h3:hover, .downloadItem h3:hover, .tabItem h3:hover {
            text-decoration: underline;
        }
        .searchResult p, .historyItem p, .bookmarkItem p, .downloadItem p, .tabItem p {
            margin: 0.25rem 0;
            color: #4b5563;
        }
        body.dark-mode .searchResult p,
        body.dark-mode .historyItem p,
        body.dark-mode .bookmarkItem p,
        body.dark-mode .downloadItem p,
        body.dark-mode .tabItem p {
            color: #d1d5db;
        }
        .searchResult a, .historyItem a, .bookmarkItem a, .downloadItem a, .tabItem a {
            color: #15803d;
            font-size: 0.875rem;
        }
        body.dark-mode .searchResult a,
        body.dark-mode .historyItem a,
        body.dark-mode .bookmarkItem a,
        body.dark-mode .downloadItem a,
        body.dark-mode .tabItem a {
            color: #34d399;
        }
        .bookmarkItem button, .downloadItem button {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background 0.3s;
        }
        .bookmarkItem button:hover, .downloadItem button:hover {
            background: #dc2626;
        }
        .downloadAppBtn {
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background 0.3s;
        }
        .downloadAppBtn:hover {
            background: #16a34a;
        }
        #userInfo {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        body.dark-mode #userInfo {
            background: rgba(0, 0, 0, 0.9);
            color: #f3f4f6;
        }
        #userInfo:hover {
            background: rgba(255, 255, 255, 1);
        }
        body.dark-mode #userInfo:hover {
            background: rgba(0, 0, 0, 1);
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        body.dark-mode button:disabled {
            background: #6b7280;
        }
        #findBar {
            display: none;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: #ffffff;
            padding: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        body.dark-mode #findBar {
            background: #1f2937;
        }
        #findInput {
            padding: 0.25rem 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.25rem;
        }
        body.dark-mode #findInput {
            border-color: #4b5563;
            background: #374151;
            color: #f3f4f6;
        }
        .highlight {
            background: #fef08a;
        }
        body.dark-mode .highlight {
            background: #facc15;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100">
    <div id="toolbar" class="sticky top-0 z-10">
        <button id="backBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="goBack()">Back</button>
        <button id="forwardBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="goForward()">Forward</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="refresh()">Refresh</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="newTab()">New Tab</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="showHistory()">History</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="showBookmarks()">Bookmarks</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="bookmarkCurrentPage()">Bookmark</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="showDownloads()">Downloads</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="showTabOverview()">Tabs</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="toggleIncognito()">Incognito: Off</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="setCustomHomepage()">Set Homepage</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="zoomIn()">Zoom In</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="zoomOut()">Zoom Out</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="findInPage()">Find</button>
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="clearData()">Clear Data</button>
        <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="downloadSuujBrowserApp()">Download App</button>
        <button id="themeToggle" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-full transition transform hover:scale-105 text-sm" onclick="toggleTheme()">Dark Mode</button>
        <input type="text" id="urlInput" class="focus:ring-2 focus:ring-blue-500" placeholder="Enter URL or search query..." onkeydown="if(event.key === 'Enter') searchOrNavigate()">
    </div>
    <div id="tabsContainer"></div>
    <div id="browserWindow">
        <div id="error"></div>
        <div id="userInfo"></div>
        <div id="findBar">
            <input type="text" id="findInput" placeholder="Find in page..." oninput="searchInPage()">
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded-full text-sm" onclick="closeFindBar()">Close</button>
        </div>
        <div id="searchResults"></div>
        <div id="newTabPage" class="flex flex-col items-center justify-content text-center">
            <h2 class="text-2xl font-bold">Welcome to Suuj Browser</h2>
            <p class="mt-2">Search for any website or enter a URL to get started.</p>
            <div class="mt-4">
                <a href="#" class="quickLink bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105 mx-1" onclick="navigate('https://www.example.com'); return false;">Example</a>
                <a href="#" class="quickLink bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105 mx-1" onclick="navigate('https://www.wikipedia.org'); return false;">Wikipedia</a>
                <a href="#" class="quickLink bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full transition transform hover:scale-105 mx-1" onclick="navigate('https://www.github.com'); return false;">GitHub</a>
            </div>
        </div>
        <div id="historyPanel"></div>
        <div id="bookmarksPanel"></div>
        <div id="downloadsPanel"></div>
        <div id="tabOverview"></div>
    </div>

    <script>
        let tabs = [];
        let currentTabIndex = -1;
        let historyList = JSON.parse(localStorage.getItem('browserHistory')) || [];
        let bookmarks = JSON.parse(localStorage.getItem('browserBookmarks')) || [];
        let searchCache = JSON.parse(localStorage.getItem('searchCache')) || [];
        let downloads = JSON.parse(localStorage.getItem('browserDownloads')) || [];
        let customHomepage = localStorage.getItem('customHomepage') || 'about:newtab';
        let isIncognito = false;
        let zoomLevel = 1;

        // List of CORS proxies to try
        const proxies = [
            { url: 'https://api.allorigins.win/get?url=', name: 'AllOrigins' },
            { url: 'https://corsproxy.io/?', name: 'CorsProxyIO' },
            { url: 'https://thingproxy.freeboard.io/fetch/', name: 'ThingProxy' }
        ];

        // Load saved tabs, theme, and user info on page load
        window.onload = function() {
            const savedTabs = localStorage.getItem('browserTabs');
            const savedTheme = localStorage.getItem('browserTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').textContent = 'Light Mode';
            }
            if (savedTabs) {
                tabs = JSON.parse(savedTabs);
                if (tabs.length > 0) {
                    currentTabIndex = 0;
                    renderTabs();
                    switchTab(0);
                } else {
                    showNewTabPage();
                }
            } else {
                showNewTabPage();
            }
            makeTabsDraggable();
            fetchUserInfo();
            updateNavigationButtons();
            registerServiceWorker();
        };

        // Register Service Worker for PWA
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                // Check if the service worker file exists
                fetch('sw.js', { method: 'HEAD' })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Service Worker file not found or inaccessible (status: ${response.status})`);
                        }
                        // Proceed with registration
                        return navigator.serviceWorker.register('sw.js', { scope: './' });
                    })
                    .then(reg => {
                        console.log('Service Worker registered with scope:', reg.scope);
                        showError('Service Worker registered successfully with scope: ' + reg.scope);
                    })
                    .catch(err => {
                        console.error('Service Worker registration failed:', err);
                        let errorMessage = `Service Worker registration failed: ${err.message}`;
                        if (err.message.includes('security')) {
                            errorMessage += '\nEnsure you are accessing the browser via http://localhost or https:// (secure context required).';
                        } else if (err.message.includes('not found') || err.message.includes('404')) {
                            errorMessage += '\nEnsure sw.js is in the same directory as simple_browser.html and is accessible at the hosted URL (e.g., via GitHub Pages).';
                        } else if (err.message.includes('scope')) {
                            errorMessage += '\nThere may be a scope mismatch. Ensure sw.js is in the correct directory and the scope ./ is appropriate.';
                        }
                        showError(errorMessage);
                    });
            } else {
                console.error('Service Workers not supported in this browser');
                showError('Service Workers not supported in this browser');
            }
        }

        // Fetch user location and display info
        function fetchUserInfo() {
            fetch('http://ip-api.com/json/')
                .then(response => response.json())
                .then(data => {
                    const userInfoDiv = document.getElementById('userInfo');
                    userInfoDiv.innerHTML = `ðŸ“ ${data.city}, ${data.country} | ðŸ•’ ${new Date().toLocaleTimeString()}`;
                })
                .catch(error => {
                    console.error('Error fetching user info:', error);
                    document.getElementById('userInfo').innerHTML = 'ðŸ“ Unknown | ðŸ•’ ' + new Date().toLocaleTimeString();
                });
        }

        function showNewTabPage() {
            document.getElementById('newTabPage').style.display = 'flex';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.getElementById('downloadsPanel').style.display = 'none';
            document.getElementById('tabOverview').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });
            updateNavigationButtons();
        }

        function newTab(url = null) {
            const tabId = Date.now();
            const tab = { id: tabId, url: url || customHomepage, history: [url || customHomepage], historyIndex: 0 };
            tabs.push(tab);
            currentTabIndex = tabs.length - 1;

            if (url && url !== 'about:newtab') {
                const contentContainer = document.createElement('div');
                contentContainer.className = 'siteContentContainer';
                contentContainer.id = `content-${tabId}`;
                document.getElementById('browserWindow').appendChild(contentContainer);
            }

            renderTabs();
            switchTab(currentTabIndex);
            if (!isIncognito) backupTabs();
            updateNavigationButtons();
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('tabsContainer');
            tabsContainer.innerHTML = '';
            tabs.forEach((tab, index) => {
                const tabElement = document.createElement('div');
                tabElement.className = `tab ${index === currentTabIndex ? 'active' : ''}`;
                tabElement.draggable = true;
                tabElement.dataset.index = index;
                tabElement.innerHTML = `
                    <span onclick="switchTab(${index})">${tab.url === 'about:newtab' ? 'New Tab' : new URL(tab.url).hostname}</span>
                    <span class="closeTab" onclick="closeTab(${index})">x</span>
                `;
                tabsContainer.appendChild(tabElement);
            });
        }

        function makeTabsDraggable() {
            const tabsContainer = document.getElementById('tabsContainer');
            let draggedTab = null;

            tabsContainer.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('tab')) {
                    draggedTab = e.target;
                    e.target.style.opacity = '0.5';
                }
            });

            tabsContainer.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('tab')) {
                    e.target.style.opacity = '1';
                    draggedTab = null;
                }
            });

            tabsContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            tabsContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                const targetTab = e.target.closest('.tab');
                if (targetTab && draggedTab && targetTab !== draggedTab) {
                    const draggedIndex = parseInt(draggedTab.dataset.index);
                    const targetIndex = parseInt(targetTab.dataset.index);
                    const [movedTab] = tabs.splice(draggedIndex, 1);
                    tabs.splice(targetIndex, 0, movedTab);
                    currentTabIndex = tabs.findIndex(tab => tab.id === movedTab.id);
                    renderTabs();
                    switchTab(currentTabIndex);
                }
            });
        }

        function switchTab(index) {
            if (index < 0 || index >= tabs.length) return;
            currentTabIndex = index;
            const tab = tabs[index];

            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab) tab.classList.remove('active');
            });

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.getElementById('downloadsPanel').style.display = 'none';
            document.getElementById('tabOverview').style.display = 'none';
            closeFindBar();

            if (tab.url === 'about:newtab') {
                showNewTabPage();
            } else {
                let contentContainer = document.getElementById(`content-${tab.id}`);
                if (!contentContainer) {
                    contentContainer = document.createElement('div');
                    contentContainer.className = 'siteContentContainer';
                    contentContainer.id = `content-${tab.id}`;
                    document.getElementById('browserWindow').appendChild(contentContainer);
                }
                contentContainer.classList.add('active');
                renderSiteContent(tab.url, contentContainer);
            }

            const tabElement = document.getElementsByClassName('tab')[index];
            if (tabElement) tabElement.classList.add('active');
            document.getElementById('urlInput').value = tab.url === 'about:newtab' ? '' : tab.url;
            updateNavigationButtons();
        }

        function closeTab(index) {
            const tabId = tabs[index].id;
            const contentContainer = document.getElementById(`content-${tabId}`);
            if (contentContainer) contentContainer.remove();
            tabs.splice(index, 1);
            if (tabs.length === 0) {
                currentTabIndex = -1;
                showNewTabPage();
            } else {
                if (currentTabIndex >= tabs.length) {
                    currentTabIndex = tabs.length - 1;
                }
                switchTab(currentTabIndex);
            }
            renderTabs();
            if (!isIncognito) backupTabs();
            updateNavigationButtons();
        }

        function searchOrNavigate() {
            const urlInput = document.getElementById('urlInput').value.trim();
            if (!urlInput) {
                showError('Please enter a URL or search query.');
                return;
            }

            let url = urlInput;
            if (!url.includes('.')) {
                performSearch(url);
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = `https://${url}`;
            }

            navigate(url);
        }

        function performSearch(query) {
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '<p>Searching...</p>';
            searchResultsDiv.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.getElementById('downloadsPanel').style.display = 'none';
            document.getElementById('tabOverview').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            // Check cache first
            if (searchCache[query]) {
                renderSearchResults(searchCache[query], query);
                return;
            }

            // Use DuckDuckGo API for real-time search
            fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1`)
                .then(response => response.json())
                .then(data => {
                    const results = data.RelatedTopics.filter(topic => topic.FirstURL);
                    if (results.length === 0) {
                        // Fallback: Try assuming a URL with different TLDs
                        const tlds = ['.com', '.org', '.net', '.edu', '.gov'];
                        const assumedUrls = tlds.map(tld => `https://${query.replace(/\s+/g, '')}${tld}`);
                        const assumedResults = assumedUrls.map(url => ({
                            FirstURL: url,
                            Text: `${query} (Assumed Site) - This site may not be in our database. Navigate to explore it.`
                        }));
                        searchCache[query] = assumedResults;
                        if (!isIncognito) localStorage.setItem('searchCache', JSON.stringify(searchCache));
                        renderSearchResults(assumedResults, query);
                        return;
                    }

                    searchCache[query] = results;
                    if (!isIncognito) localStorage.setItem('searchCache', JSON.stringify(searchCache));
                    renderSearchResults(results, query);
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                    // Fallback: Assume a URL if search fails
                    const assumedUrl = `https://${query.replace(/\s+/g, '')}.com`;
                    const assumedResults = [{
                        FirstURL: assumedUrl,
                        Text: `${query} (Assumed Site) - This site may not be in our database. Navigate to explore it.`
                    }];
                    searchCache[query] = assumedResults;
                    if (!isIncognito) localStorage.setItem('searchCache', JSON.stringify(searchCache));
                    renderSearchResults(assumedResults, query);
                });
        }

        function renderSearchResults(results, query) {
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '';

            results.forEach(result => {
                const url = result.FirstURL;
                const title = result.Text.split(' - ')[0];
                const description = result.Text;
                const favicon = `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}`;

                const resultDiv = document.createElement('div');
                resultDiv.className = 'searchResult';
                resultDiv.innerHTML = `
                    <a href="${url}" onclick="navigate('${url}'); return false;">${url}</a>
                    <h3 onclick="navigate('${url}')"><img src="${favicon}" alt="Favicon" class="favicon">${title}</h3>
                    <p>Browser: Suuj Browser</p>
                    <p>${description}</p>
                    <button class="downloadAppBtn" onclick="downloadApp('${title}', '${url}')">Download as App</button>
                `;
                searchResultsDiv.appendChild(resultDiv);
            });
            updateNavigationButtons();
        }

        function fetchWithProxies(url, container, proxyIndex = 0) {
            if (proxyIndex >= proxies.length) {
                // All proxies failed, attempt a fallback using DuckDuckGo API
                fetchSiteInfoFallback(url, container);
                return;
            }

            const proxy = proxies[proxyIndex];
            const proxyUrl = `${proxy.url}${encodeURIComponent(url)}`;

            fetch(proxyUrl)
                .then(response => response.json())
                .then(data => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data.contents || data.data || '', 'text/html');
                    const title = doc.querySelector('title')?.textContent || doc.querySelector('meta[name="og:title"]')?.content || new URL(url).hostname;
                    const description = doc.querySelector('meta[name="description"]')?.content || doc.querySelector('meta[name="og:description"]')?.content || 'No description available.';
                    const favicon = `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}`;

                    // Extract more elements for a richer view
                    const headings = Array.from(doc.querySelectorAll('h1, h2, h3')).map(h => `<h${h.tagName.charAt(1)}>${h.textContent}</h${h.tagName.charAt(1)}>`).join('');
                    const articles = Array.from(doc.querySelectorAll('article')).map(article => `<div>${article.innerHTML}</div>`).join('');
                    const paragraphs = Array.from(doc.querySelectorAll('p')).map(p => `<p>${p.textContent}</p>`).join('');
                    const images = Array.from(doc.querySelectorAll('img')).filter(img => img.src).map(img => `<img src="${img.src}" alt="${img.alt || 'Image'}" class="extracted-image">`).join('');
                    const lists = Array.from(doc.querySelectorAll('ul, ol')).map(list => `<${list.tagName.toLowerCase()}>${Array.from(list.querySelectorAll('li')).map(li => `<li>${li.textContent}</li>`).join('')}</${list.tagName.toLowerCase()}>`).join('');
                    const tables = Array.from(doc.querySelectorAll('table')).map(table => `<table border="1">${Array.from(table.querySelectorAll('tr')).map(row => `<tr>${Array.from(row.querySelectorAll('td, th')).map(cell => `<${cell.tagName.toLowerCase()}>${cell.textContent}</${cell.tagName.toLowerCase()}>`).join('')}</tr>`).join('')}</table>`).join('');
                    const content = (headings || articles || paragraphs || images || lists || tables) ? `${headings}${articles}${paragraphs}${images}${lists}${tables}` : 'No additional content available.';

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'siteContent';
                    contentDiv.style.transform = `scale(${zoomLevel})`;
                    contentDiv.style.transformOrigin = 'top left';
                    contentDiv.innerHTML = `
                        <a href="${url}" onclick="navigate('${url}'); return false;">${url}</a>
                        <h3><img src="${favicon}" alt="Favicon" class="favicon">${title}</h3>
                        <p>${description}</p>
                        <p>Browser: Suuj Browser</p>
                        <div class="extracted-content">${content}</div>
                        <button class="downloadAppBtn" onclick="downloadApp('${title}', '${url}')">Download as App</button>
                    `;

                    // Intercept all link clicks within the content
                    contentDiv.querySelectorAll('a').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const href = link.getAttribute('href');
                            if (href && !href.startsWith('#')) {
                                navigate(href.startsWith('http') ? href : new URL(href, url).href);
                            }
                        });
                    });

                    container.innerHTML = '';
                    container.appendChild(contentDiv);
                })
                .catch(error => {
                    console.error(`Error fetching site content with ${proxy.name}:`, error);
                    // Try the next proxy
                    fetchWithProxies(url, container, proxyIndex + 1);
                });
        }

        function fetchSiteInfoFallback(url, container) {
            // Use DuckDuckGo API to get basic site info as a last resort
            const query = new URL(url).hostname;
            fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1`)
                .then(response => response.json())
                .then(data => {
                    const result = data.RelatedTopics.find(topic => topic.FirstURL.includes(query)) || {};
                    const title = result.Text?.split(' - ')[0] || new URL(url).hostname;
                    const description = result.Text || 'Unable to load content for this site. This may be due to security restrictions (e.g., CORS, X-Frame-Options) or connectivity issues.';
                    const favicon = `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}`;

                    container.innerHTML = `
                        <div class="siteContent">
                            <a href="${url}" onclick="navigate('${url}'); return false;">${url}</a>
                            <h3><img src="${favicon}" alt="Favicon" class="favicon">${title}</h3>
                            <p>${description}</p>
                            <p>Browser: Suuj Browser</p>
                            <p>
                                <a href="#" onclick="navigate('${url}'); return false;">Retry</a> |
                                <a href="#" onclick="performSearch('${new URL(url).hostname}'); return false;">Search for alternatives</a> |
                                <a href="${url}" onclick="navigate('${url}'); return false;">Visit site in Suuj Browser</a>
                            </p>
                            <button class="downloadAppBtn" onclick="downloadApp('${title}', '${url}')">Download as App</button>
                        </div>
                    `;
                })
                .catch(error => {
                    console.error('Error fetching site info via DuckDuckGo:', error);
                    const title = new URL(url).hostname;
                    const favicon = `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}`;
                    container.innerHTML = `
                        <div class="siteContent">
                            <a href="${url}" onclick="navigate('${url}'); return false;">${url}</a>
                            <h3><img src="${favicon}" alt="Favicon" class="favicon">${title}</h3>
                            <p>Unable to load content for this site. This may be due to security restrictions (e.g., CORS, X-Frame-Options) or connectivity issues.</p>
                            <p>Browser: Suuj Browser</p>
                            <p>
                                <a href="#" onclick="navigate('${url}'); return false;">Retry</a> |
                                <a href="#" onclick="performSearch('${new URL(url).hostname}'); return false;">Search for alternatives</a> |
                                <a href="${url}" onclick="navigate('${url}'); return false;">Visit site in Suuj Browser</a>
                            </p>
                            <button class="downloadAppBtn" onclick="downloadApp('${title}', '${url}')">Download as App</button>
                        </div>
                    `;
                });
        }

        function renderSiteContent(url, container) {
            container.innerHTML = '<p>Loading content...</p>';
            fetchWithProxies(url, container);
            updateNavigationButtons();
        }

        function downloadApp(siteName, siteUrl, appLink) {
            const content = appLink ? 
                `App Download for ${siteName}\n\nVisit the following link to download the app on your phone:\n${appLink}\n\nAlternatively, search for "${siteName}" in your phone's app store.` :
                `App Download for ${siteName}\n\nNo app link available for this site.\nVisit ${siteUrl} on your phone and look for a mobile app option, or search for "${siteName}" in your phone's app store.`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${siteName.replace(/\s+/g, '_')}_app_info.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            if (!isIncognito) {
                downloads.push({
                    name: siteName,
                    url: siteUrl,
                    timestamp: new Date().toLocaleString()
                });
                localStorage.setItem('browserDownloads', JSON.stringify(downloads));
            }
        }

        function downloadSuujBrowserApp() {
            const siteName = "Suuj Browser";
            const githubPagesUrl = "https://your-username.github.io/your-repo/simple_browser.html"; // Replace with your actual GitHub Pages URL
            const message = `Install ${siteName} on Your Phone:\n1. Open Chrome on your phone.\n2. Visit: ${githubPagesUrl}\n3. Tap the three-dot menu in Chrome and select "Add to Home screen" (Android) or tap the share icon and select "Add to Home Screen" (iOS).\n4. Follow the prompts to add Suuj Browser to your home screen.`;
            showError(message);
        }

        function navigate(url) {
            let tab = tabs[currentTabIndex];
            let contentContainer = document.getElementById(`content-${tab.id}`);

            if (tab.url === 'about:newtab' || !contentContainer) {
                const tabId = tab.id;
                contentContainer = document.createElement('div');
                contentContainer.className = 'siteContentContainer';
                contentContainer.id = `content-${tabId}`;
                document.getElementById('browserWindow').appendChild(contentContainer);
            }

            tab.url = url;
            contentContainer.classList.add('active');

            tab.history = tab.history.slice(0, tab.historyIndex + 1);
            tab.history.push(url);
            tab.historyIndex = tab.history.length - 1;

            if (!isIncognito) {
                historyList.push({
                    url: url,
                    title: new URL(url).hostname,
                    timestamp: new Date().toLocaleString()
                });
                localStorage.setItem('browserHistory', JSON.stringify(historyList));
                backupTabs();
            }

            document.getElementById('urlInput').value = url;
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.getElementById('downloadsPanel').style.display = 'none';
            document.getElementById('tabOverview').style.display = 'none';
            renderTabs();

            renderSiteContent(url, contentContainer);
            updateNavigationButtons();
        }

        function goBack() {
            const tab = tabs[currentTabIndex];
            if (tab.historyIndex > 0) {
                tab.historyIndex--;
                tab.url = tab.history[tab.historyIndex];
                const contentContainer = document.getElementById(`content-${tab.id}`);
                if (contentContainer) {
                    renderSiteContent(tab.url, contentContainer);
                    document.getElementById('urlInput').value = tab.url;
                    renderTabs();
                    updateNavigationButtons();
                }
            }
        }

        function goForward() {
            const tab = tabs[currentTabIndex];
            if (tab.historyIndex < tab.history.length - 1) {
                tab.historyIndex++;
                tab.url = tab.history[tab.historyIndex];
                const contentContainer = document.getElementById(`content-${tab.id}`);
                if (contentContainer) {
                    renderSiteContent(tab.url, contentContainer);
                    document.getElementById('urlInput').value = tab.url;
                    renderTabs();
                    updateNavigationButtons();
                }
            }
        }

        function refresh() {
            const tab = tabs[currentTabIndex];
            if (tab.url === 'about:newtab') {
                showNewTabPage();
            } else {
                const contentContainer = document.getElementById(`content-${tab.id}`);
                if (contentContainer) {
                    renderSiteContent(tab.url, contentContainer);
                }
            }
            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const tab = tabs[currentTabIndex];
            if (!tab) {
                document.getElementById('backBtn').disabled = true;
                document.getElementById('forwardBtn').disabled = true;
                return;
            }
            document.getElementById('backBtn').disabled = tab.historyIndex <= 0;
            document.getElementById('forwardBtn').disabled = tab.historyIndex >= tab.history.length - 1;
        }

        function backupTabs() {
            localStorage.setItem('browserTabs', JSON.stringify(tabs));
        }

        function showHistory() {
            const historyPanel = document.getElementById('historyPanel');
            historyPanel.innerHTML = '<h2 class="text-xl font-bold mb-4">Browsing History</h2>';
            historyPanel.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.getElementById('downloadsPanel').style.display = 'none';
            document.getElementById('tabOverview').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            if (historyList.length === 0) {
                historyPanel.innerHTML += '<p>No history available.</p>';
                return;
            }

            historyList.forEach(item => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'historyItem';
                historyDiv.innerHTML = `
                    <a href="${item.url}" onclick="navigate('${item.url}'); return false;">${item.url}</a>
                    <h3 onclick="navigate('${item.url}')">${item.title}</h3>
                    <p>Visited: ${item.timestamp}</p>
                `;
                historyPanel.appendChild(historyDiv);
            });
            updateNavigationButtons();
        }

        function showBookmarks() {
            const bookmarksPanel = document.getElementById('bookmarksPanel');
            bookmarksPanel.innerHTML = '<h2 class="text-xl font-bold mb-4">Bookmarks</h2>';
            bookmarksPanel.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('downloadsPanel').style.display = 'none';
            document.getElementById('tabOverview').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            if (bookmarks.length === 0) {
                bookmarksPanel.innerHTML += '<p>No bookmarks available.</p>';
                return;
            }

            bookmarks.forEach((bookmark, index) => {
                const bookmarkDiv = document.createElement('div');
                bookmarkDiv.className = 'bookmarkItem';
                bookmarkDiv.innerHTML = `
                    <a href="${bookmark.url}" onclick="navigate('${bookmark.url}'); return false;">${bookmark.url}</a>
                    <h3 onclick="navigate('${bookmark.url}')">${bookmark.title}</h3>
                    <button onclick="removeBookmark(${index})">Remove</button>
                `;
                bookmarksPanel.appendChild(bookmarkDiv);
            });
            updateNavigationButtons();
        }

        function showDownloads() {
            const downloadsPanel = document.getElementById('downloadsPanel');
            downloadsPanel.innerHTML = '<h2 class="text-xl font-bold mb-4">Downloads</h2>';
            downloadsPanel.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.getElementById('tabOverview').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            if (downloads.length === 0) {
                downloadsPanel.innerHTML += '<p>No downloads available.</p>';
                return;
            }

            downloads.forEach((download, index) => {
                const downloadDiv = document.createElement('div');
                downloadDiv.className = 'downloadItem';
                downloadDiv.innerHTML = `
                    <a href="${download.url}" onclick="navigate('${download.url}'); return false;">${download.url}</a>
                    <h3 onclick="downloadApp('${download.name}', '${download.url}')">${download.name}</h3>
                    <p>Downloaded: ${download.timestamp}</p>
                    <button onclick="removeDownload(${index})">Remove</button>
                `;
                downloadsPanel.appendChild(downloadDiv);
            });
            updateNavigationButtons();
        }

        function showTabOverview() {
            const tabOverview = document.getElementById('tabOverview');
            tabOverview.innerHTML = '<h2 class="text-xl font-bold mb-4">Open Tabs</h2>';
            tabOverview.style.display = 'block';

            document.getElementById('newTabPage').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('bookmarksPanel').style.display = 'none';
            document.getElementById('downloadsPanel').style.display = 'none';
            document.querySelectorAll('.siteContentContainer').forEach(container => {
                if (container) container.classList.remove('active');
            });

            if (tabs.length === 0) {
                tabOverview.innerHTML += '<p>No tabs open.</p>';
                return;
            }

            tabs.forEach((tab, index) => {
                const tabDiv = document.createElement('div');
                tabDiv.className = 'tabItem';
                tabDiv.innerHTML = `
                    <h3 onclick="switchTab(${index})">${tab.url === 'about:newtab' ? 'New Tab' : new URL(tab.url).hostname}</h3>
                    <p><a href="${tab.url}" onclick="navigate('${tab.url}'); return false;">${tab.url}</a></p>
                    <button onclick="closeTab(${index})">Close</button>
                `;
                tabOverview.appendChild(tabDiv);
            });
            updateNavigationButtons();
        }

        function bookmarkCurrentPage() {
            const tab = tabs[currentTabIndex];
            if (tab.url === 'about:newtab') {
                showError('No page to bookmark. Navigate to a website first.');
                return;
            }

            if (!isIncognito) {
                bookmarks.push({
                    url: tab.url,
                    title: new URL(tab.url).hostname
                });
                localStorage.setItem('browserBookmarks', JSON.stringify(bookmarks));
            }
            showBookmarks();
            updateNavigationButtons();
        }

        function removeBookmark(index) {
            bookmarks.splice(index, 1);
            if (!isIncognito) localStorage.setItem('browserBookmarks', JSON.stringify(bookmarks));
            showBookmarks();
            updateNavigationButtons();
        }

        function removeDownload(index) {
            downloads.splice(index, 1);
            if (!isIncognito) localStorage.setItem('browserDownloads', JSON.stringify(downloads));
            showDownloads();
            updateNavigationButtons();
        }

        function toggleIncognito() {
            isIncognito = !isIncognito;
            document.querySelector('button[onclick="toggleIncognito()"]').textContent = `Incognito: ${isIncognito ? 'On' : 'Off'}`;
            if (isIncognito) {
                showError('Incognito mode enabled. Browsing history, bookmarks, and downloads will not be saved.');
            }
        }

        function setCustomHomepage() {
            const url = prompt('Enter the URL for your custom homepage (e.g., https://www.example.com):', customHomepage);
            if (url) {
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    customHomepage = `https://${url}`;
                } else {
                    customHomepage = url;
                }
                if (!isIncognito) localStorage.setItem('customHomepage', customHomepage);
                showError(`Custom homepage set to ${customHomepage}`);
            }
        }

        function zoomIn() {
            zoomLevel += 0.1;
            const contentContainer = document.getElementById(`content-${tabs[currentTabIndex]?.id}`);
            if (contentContainer) {
                const siteContent = contentContainer.querySelector('.siteContent');
                if (siteContent) {
                    siteContent.style.transform = `scale(${zoomLevel})`;
                    siteContent.style.transformOrigin = 'top left';
                }
            }
        }

        function zoomOut() {
            zoomLevel = Math.max(0.5, zoomLevel - 0.1);
            const contentContainer = document.getElementById(`content-${tabs[currentTabIndex]?.id}`);
            if (contentContainer) {
                const siteContent = contentContainer.querySelector('.siteContent');
                if (siteContent) {
                    siteContent.style.transform = `scale(${zoomLevel})`;
                    siteContent.style.transformOrigin = 'top left';
                }
            }
        }

        function findInPage() {
            if (currentTabIndex === -1 || tabs[currentTabIndex].url === 'about:newtab') {
                showError('No page to search. Navigate to a website first.');
                return;
            }
            document.getElementById('findBar').style.display = 'block';
            document.getElementById('findInput').focus();
        }

        function searchInPage() {
            const query = document.getElementById('findInput').value.toLowerCase();
            const contentContainer = document.getElementById(`content-${tabs[currentTabIndex].id}`);
            if (!contentContainer) return;

            const siteContent = contentContainer.querySelector('.siteContent');
            if (!siteContent) return;

            // Remove previous highlights
            const highlights = siteContent.querySelectorAll('.highlight');
            highlights.forEach(highlight => {
                const parent = highlight.parentNode;
                parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
                parent.normalize();
            });

            if (!query) return;

            // Highlight matching text
            const walker = document.createTreeWalker(siteContent, NodeFilter.SHOW_TEXT, null, false);
            const nodes = [];
            let node;
            while ((node = walker.nextNode())) {
                if (node.parentElement.tagName !== 'SCRIPT' && node.parentElement.tagName !== 'STYLE') {
                    nodes.push(node);
                }
            }

            nodes.forEach(textNode => {
                const text = textNode.textContent;
                const index = text.toLowerCase().indexOf(query);
                if (index !== -1) {
                    const range = document.createRange();
                    range.setStart(textNode, index);
                    range.setEnd(textNode, index + query.length);
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    range.surroundContents(span);
                }
            });
        }

        function closeFindBar() {
            document.getElementById('findBar').style.display = 'none';
            document.getElementById('findInput').value = '';
            searchInPage(); // Clear highlights
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all history, bookmarks, downloads, and cache?')) {
                historyList = [];
                bookmarks = [];
                downloads = [];
                searchCache = {};
                if (!isIncognito) {
                    localStorage.setItem('browserHistory', JSON.stringify(historyList));
                    localStorage.setItem('browserBookmarks', JSON.stringify(bookmarks));
                    localStorage.setItem('browserDownloads', JSON.stringify(downloads));
                    localStorage.setItem('searchCache', JSON.stringify(searchCache));
                }
                showError('All data cleared.');
                showNewTabPage();
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            if (!isIncognito) localStorage.setItem('browserTheme', theme);
            document.getElementById('themeToggle').textContent = theme === 'dark' ? 'Light Mode' : 'Dark Mode';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 10000); // Increased to 10 seconds for readability of instructions
        }
    </script>
</body>
</html>
